<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lager-Scanner Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f0f2f5; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 12px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; margin-top: 5px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.3s; }
        .btn-scan { background-color: #e8f0fe; color: #1a73e8; border: 1px solid #1a73e8; }
        .btn-save { background-color: #34a853; color: white; margin-top: 20px; font-size: 18px; }
        #scanner-container { width: 100%; height: 250px; display: none; border: 2px solid #1a73e8; margin-top: 10px; position: relative; overflow: hidden; }
        #scanner-container video { width: 100%; height: auto; }
        canvas.drawingBuffer { position: absolute; top: 0; left: 0; }
        .history { margin-top: 30px; border-top: 1px solid #eee; padding-top: 10px; }
        .entry { font-size: 0.8em; background: #fafafa; padding: 5px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="container">
    <h2>Lager-Scanner</h2>

    <div id="scanner-container"></div>
    <button id="stop-btn" style="display:none; background:#ea4335; color:white;" onclick="stopScanner()">Abbrechen</button>

    <hr>

    <div class="input-group">
        <label>Stellplatz (Scan 1)</label>
        <input type="text" id="stellplatz" placeholder="Wird gescannt...">
        <button class="btn-scan" onclick="startScanner('stellplatz')">ðŸ“· Stellplatz scannen</button>
    </div>

    <div class="input-group">
        <label>Produkt (Scan 2)</label>
        <input type="text" id="produkt" placeholder="Wird gescannt...">
        <button class="btn-scan" onclick="startScanner('produkt')">ðŸ“· Produkt scannen</button>
    </div>

    <div class="input-group">
        <label>Artikelnummer (Manuell)</label>
        <input type="text" id="artikelnr" placeholder="Nummer eingeben...">
    </div>

    <button class="btn-save" onclick="saveToHistory()">Eintrag Speichern</button>

    <div class="history" id="history">
        <strong>Letzte Scans:</strong>
    </div>
</div>

<script>
    let activeField = null;

    function startScanner(targetId) {
        activeField = targetId;
        document.getElementById('scanner-container').style.display = 'block';
        document.getElementById('stop-btn').style.display = 'block';

        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: document.querySelector('#scanner-container'),
                constraints: { facingMode: "environment" }
            },
            decoder: {
                readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader"]
            }
        }, function(err) {
            if (err) { console.error(err); return; }
            Quagga.start();
        });

        Quagga.onDetected(function(data) {
            document.getElementById(activeField).value = data.codeResult.code;
            stopScanner();
            // Visuelles Feedback
            document.getElementById(activeField).style.backgroundColor = "#e6ffed";
        });
    }

    function stopScanner() {
        Quagga.stop();
        document.getElementById('scanner-container').style.display = 'none';
        document.getElementById('stop-btn').style.display = 'none';
    }

    function saveToHistory() {
        const p = document.getElementById('stellplatz').value;
        const pr = document.getElementById('produkt').value;
        const nr = document.getElementById('artikelnr').value;

        if(!p || !pr) { alert("Bitte erst scannen!"); return; }

        const entry = document.createElement('div');
        entry.className = 'entry';
        entry.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> Platz: ${p} | Prod: ${pr} | ArtNr: ${nr}`;
        document.getElementById('history').prepend(entry);

        // Felder leeren fÃ¼r nÃ¤chsten Scan
        document.getElementById('produkt').value = "";
        document.getElementById('artikelnr').value = "";
        document.getElementById('produkt').style.backgroundColor = "white";
    }
</script>

</body>
</html>